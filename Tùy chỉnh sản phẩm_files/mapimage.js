(function(e){var t=e.mapster,n=t.utils,r=[];t.MapImages=function(e){this.owner=e;this.clear()};t.MapImages.prototype={constructor:t.MapImages,slice:function(){return r.slice.apply(this,arguments)},splice:function(){r.slice.apply(this.status,arguments);var e=r.slice.apply(this,arguments);return e},complete:function(){return e.inArray(false,this.status)<0},_add:function(e){var t=r.push.call(this,e)-1;this.status[t]=false;return t},indexOf:function(e){return n.indexOf(this,e)},clear:function(){var t= this;if(t.ids&&t.ids.length>0)e.each(t.ids,function(e,n){delete t[n]});t.ids=[];t.length=0;t.status=[];t.splice(0)},add:function(t,n){var r,i,s=this;if(!t)return;if(typeof t==="string"){i=t;t=s[i];if(typeof t==="object")return s.indexOf(t);t=e("<img />").addClass("mapster_el").hide();r=s._add(t[0]);t.bind("load",function(e){s.imageLoaded.call(s,e)}).bind("error",function(e){s.imageLoadError.call(s,e)});t.attr("src",i)}else r=s._add(e(t)[0]);if(n){if(this[n])throw n+" is already used or is not available as an altImage alias."; s.ids.push(n);s[n]=s[r]}return r},bind:function(e){var t=this,r,i=t.owner.options.configTimeout/200,s=function(){var e;e=t.length;while(e-- >0)if(!t.isLoaded(e))break;if(t.complete())t.resolve();else if(i-- >0)t.imgTimeout=window.setTimeout(function(){s.call(t,true)},50);else t.imageLoadError.call(t)};r=t.deferred=n.defer();s();return r},resolve:function(){var e=this,t=e.deferred;if(t){e.deferred=null;t.resolve()}},imageLoaded:function(t){var n=this,r=n.indexOf(t.target);if(r>=0){n.status[r]=true; if(e.inArray(false,n.status)<0)n.resolve()}},imageLoadError:function(e){clearTimeout(this.imgTimeout);this.triesLeft=0;var t=e?"The image "+e.target.src+" failed to load.":"The images never seemed to finish loading. You may just need to increase the configTimeout if images could take a long time to load.";throw t;},isLoaded:function(e){var t,r=this,i=r.status;if(i[e])return true;t=r[e];if(typeof t.complete!=="undefined")i[e]=t.complete;else i[e]=!!n.imgWidth(t);return i[e]}}})(jQuery);