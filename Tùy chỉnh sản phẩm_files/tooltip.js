(function(e){function r(t,n,r){var i;if(n){i=typeof n==="string"?e(n):e(n).clone();i.append(t)}else i=e(t);i.css(e.extend(r||{},{display:"block",position:"absolute"})).hide();e("body").append(i);i.attr("data-opacity",i.css("opacity")).css("opacity",0);return i.show()}function i(e,t){var r={left:t.left+"px",top:t.top+"px"},i=e.attr("data-opacity")||0,s=e.css("z-index");if(parseInt(s,10)===0||s==="auto")r["z-index"]=9999;e.css(r).addClass("mapster_tooltip");if(t.fadeDuration&&t.fadeDuration>0)n.fader(e[0], 0,i,t.fadeDuration);else n.setOpacity(e[0],i)}function s(t,n,r,i,s,o){var u=r+".mapster-tooltip";if(e.inArray(n,t)>=0){i.unbind(u).bind(u,function(e){if(!s||s.call(this,e)){i.unbind(".mapster-tooltip");if(o)o.call(this)}});return{object:i,event:u}}}function o(e,t,r,s,o){var u,a={};o=o||{};if(t){u=n.areaCorners(t,r,s,e.outerWidth(true),e.outerHeight(true));a.left=u[0];a.top=u[1]}else{a.left=o.left;a.top=o.top}a.left+=o.offsetx||0;a.top+=o.offsety||0;a.css=o.css;a.fadeDuration=o.fadeDuration;i(e,a); return e}function u(e){return e?typeof e==="string"||e.jquery?e:e.content:null}var t=e.mapster,n=t.utils;e.extend(t.defaults,{toolTipContainer:'<div style="border: 2px solid black; background: #EEEEEE; width:160px; padding:4px; margin: 4px; -moz-box-shadow: 3px 3px 5px #535353; '+"-webkit-box-shadow: 3px 3px 5px #535353; box-shadow: 3px 3px 5px #535353; -moz-border-radius: 6px 6px 6px 6px; -webkit-border-radius: 6px; "+'border-radius: 6px 6px 6px 6px; opacity: 0.9;"></div>',showToolTip:false,toolTipFade:true, toolTipClose:["area-mouseout","image-mouseout"],onShowToolTip:null,onHideToolTip:null});e.extend(t.area_defaults,{toolTip:null,toolTipClose:null});t.MapData.prototype.clearToolTip=function(){if(this.activeToolTip){this.activeToolTip.stop().remove();this.activeToolTip=null;this.activeToolTipID=null;n.ifFunction(this.options.onHideToolTip,this)}};t.AreaData.prototype.showToolTip=function(t,i){var u,a,f,l,c,h={},p=this,d=p.owner,v=p.effectiveOptions();i=i?e.extend({},i):{};t=t||v.toolTip;a=i.closeEvents|| v.toolTipClose||d.options.toolTipClose||"tooltip-click";c=typeof i.template!=="undefined"?i.template:d.options.toolTipContainer;i.closeEvents=typeof a==="string"?a=n.split(a):a;i.fadeDuration=i.fadeDuration||(d.options.toolTipFade?d.options.fadeDuration||v.fadeDuration:0);f=p.area?p.area:e.map(p.areas(),function(e){return e.area});if(d.activeToolTipID===p.areaId)return;d.clearToolTip();d.activeToolTip=u=r(t,c,i.css);d.activeToolTipID=p.areaId;l=function(){d.clearToolTip()};s(a,"area-click","click", e(d.map),null,l);s(a,"tooltip-click","click",u,null,l);s(a,"image-mouseout","mouseout",e(d.image),function(e){return e.relatedTarget&&e.relatedTarget.nodeName!=="AREA"&&e.relatedTarget!==p.area},l);o(u,f,d.image,i.container,c,i);n.ifFunction(d.options.onShowToolTip,p.area,{toolTip:u,options:h,areaOptions:v,key:p.key,selected:p.isSelected()});return u};t.impl.tooltip=function(n,i){return(new t.Method(this,function(){var a,f,l=this;if(!n)l.clearToolTip();else{f=e(n);if(l.activeToolTipID===f[0])return; l.clearToolTip();l.activeToolTip=a=r(u(i),i.template||l.options.toolTipContainer,i.css);l.activeToolTipID=f[0];s(["tooltip-click"],"tooltip-click","click",a,null,function(){l.clearToolTip()});l.activeToolTip=a=o(a,f,l.image,i.container,i)}},function(){if(e.isPlainObject(n)&&!i)i=n;this.showToolTip(u(i),i)},{name:"tooltip",args:arguments,key:n})).go()}})(jQuery);