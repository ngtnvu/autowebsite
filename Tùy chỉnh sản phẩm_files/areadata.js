(function(e){function r(t){var n=this,r=n.owner;if(r.options.singleSelect)r.clearSelections();if(!n.isSelected()){if(t)n.optsCache=e.extend(n.effectiveRenderOptions("select"),t,{altImageId:r.images.add(t.altImage)});n.drawSelection();n.selected=true;n.changeState("select",true)}if(r.options.singleSelect)r.graphics.refreshSelections()}function i(e){var t=this;t.selected=false;t.changeState("select",false);t.optsCache=null;t.owner.graphics.removeSelections(t.areaId);if(!e)t.owner.removeSelectionFinish()} function s(e){var t=this;if(!t.isSelected())t.select(e);else t.deselect();return t.isSelected()}var t=e.mapster,n=t.utils;t.AreaData=function(t,n,r){e.extend(this,{owner:t,key:n||"",isPrimary:true,areaId:-1,href:"",value:r||"",options:{},selected:null,areasXref:[],area:null,optsCache:null})};t.AreaData.prototype={constuctor:t.AreaData,select:r,deselect:i,toggle:s,areas:function(){var e,t=[];for(e=0;e<this.areasXref.length;e++)t.push(this.owner.mapAreas[this.areasXref[e]]);return t},coords:function(t){var n= [];e.each(this.areas(),function(e,r){n=n.concat(r.coords(t))});return n},reset:function(){e.each(this.areas(),function(e,t){t.reset()});this.areasXref=[];this.options=null},isSelectedOrStatic:function(){var e=this.effectiveOptions();return n.isBool(e.staticState)?e.staticState:this.isSelected()},isSelected:function(){return n.isBool(this.selected)?this.selected:n.isBool(this.owner.area_options.selected)?this.owner.area_options.selected:false},isSelectable:function(){return n.isBool(this.effectiveOptions().staticState)? false:n.isBool(this.owner.options.staticState)?false:n.boolOrDefault(this.effectiveOptions().isSelectable,true)},isDeselectable:function(){return n.isBool(this.effectiveOptions().staticState)?false:n.isBool(this.owner.options.staticState)?false:n.boolOrDefault(this.effectiveOptions().isDeselectable,true)},isNotRendered:function(){var t=e(this.area);return t.attr("nohref")||!t.attr("href")||this.effectiveOptions().isMask},effectiveOptions:function(e){var t=n.updateProps({},this.owner.area_options, this.options,e||{},{id:this.areaId});t.selected=this.isSelected();return t},effectiveRenderOptions:function(t,r){var i,s=this.optsCache;if(!s||t==="highlight"){i=this.effectiveOptions(r);s=n.updateProps({},i,i["render_"+t]);if(t!=="highlight")this.optsCache=s}return e.extend({},s)},changeState:function(t,n){if(e.isFunction(this.owner.options.onStateChange))this.owner.options.onStateChange.call(this.owner.image,{key:this.key,state:t,selected:n})},highlight:function(e){var t=this.owner;if(this.effectiveOptions().highlight)t.graphics.addShapeGroup(this, "highlight",e);t.setHighlightId(this.areaId);this.changeState("highlight",true)},drawSelection:function(){this.owner.graphics.addShapeGroup(this,"select")}};t.MapArea=function(t,r,i){if(!t)return;var s=this;s.owner=t;s.area=r;s.areaDataXref=[];s.originalCoords=[];e.each(n.split(r.coords),function(e,t){s.originalCoords.push(parseFloat(t))});s.length=s.originalCoords.length;s.shape=r.shape.toLowerCase();s.nohref=r.nohref||!r.href;s.configure(i)};t.MapArea.prototype={constructor:t.MapArea,configure:function(e){this.keys= n.split(e)},reset:function(){this.area=null},coords:function(t){return e.map(this.originalCoords,function(e){return t?e:e+t})}}})(jQuery);